\documentclass[a4paper,12pt,oneside]{report}

\newif\ifrelease % new boolean variable release. True = include some fancy content
\releasetrue % and set it

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{epsfig}
\usepackage{graphicx}
\ifrelease
	\usepackage{pdfpages}
\fi
\usepackage[pagebackref=true]{hyperref} % tento balicek by mel byt na konci baliku!

\hypersetup{
	pdfauthor={Matej Laitl},
	pdftitle={Implementation environment for Bayesian filtering algorithms}
}

%% Nastavení zrcadla sazby
\usepackage{calc}
\setlength{\textheight}{9in}
\setlength{\textwidth}{6in}
\setlength\oddsidemargin{(\paperwidth-\textwidth)/2 - 1in}
\setlength\evensidemargin{(\paperwidth-\textwidth)/2 - 1in}
\setlength\topmargin{(\paperheight-\textheight-\headheight-\headsep-\footskip)/2 - 1in}

% TODO: je toto potreba?
%\parindent=0pt % odsazení 1. řádku odstavce
%\parskip=7pt   % mezera mezi odstavci

\ifrelease
	\hypersetup{pdfborder={0 0 0}} % no borders around links
\else
	\hypersetup{colorlinks=true} % colour links instead of borders
\fi

\begin{document}

\ifrelease
	\input{startpages.tex} % include some fancy start pages
\fi


% obsah
\newpage
\tableofcontents


\chapter*{Introduction} \addcontentsline{toc}{chapter}{Introduction}

TODO motivatin for bayes filtration + a need for a convenient library (rapid prototyping vs. speed)

applications: robotics, navigation, + tracking of toxic plume after radiation accident.

Decision-making being a logical and natural ``next step'' - beyond the scope of this text.

[proposed citations:\cite{ThrBurFox:05,Gus:02,HofSmi:09,HofSmiPech:09,PechHofSmi:09}]


\chapter*{Notation} \addcontentsline{toc}{chapter}{Notation}

Throughout this text, following notation is used

\bigskip

\begin{tabular}{l p{0.8\textwidth}}
	\(\mathbb{N}\) & set of natural numbers \\
	\(\mathbb{R}\) & set of real numbers \\
	\(t\) & discrete time moment; \(t \in \mathbb{N}\) \\
	\(a_t\) & value of quantity \(a\) at time \(t\); \(a_t \in \mathbb{R}^n, n \in \mathbb{N}\) \\
		& unless noted otherwise, \(x_t\) denotes state vector at time \(t\) and \(y_t\) denotes
		  observation vector at time \(t\) \\
	\(a_{i:j}\) & sequence of quantities \((a_i, a_{i+1} \dots a_{j-1}, a_j)\) \\
\end{tabular}


\chapter{Basics of Recursive Bayesian Estimation}

\section{Problem Statement}

Assume a dynamic system described by a hidden state vector of real numbers,
denoted in this text as \(x_t\) ... evolves at discrete time steps according to a known, assumed or
approximated function \(f_t\)
\[ x_t = f_t(x_{t-1}, v_{t-1}) \]
where \(v_t\) is unevitable and random process noise, that comes from ... ... .. .

also assume that we can obseve the system in each time step through an observation \(y_t\) that relates
to the state, but may contain less information and adds further noise. 
\[ y_t = h_t(x_t, w_t) \]
where \(w_t\) is unevitable and random observation noise.

Our goal is to estimate the hidden state \(x_t\) given the observations \(y_{1:t}\) 

resursive = we do not need to keep track of all previous observations/state predictions, only
appropriate \(a_{t-1}\) quantities are needed to estimate \(x_t\).

\section{Theoretical solution}

[Main source for these 2 sections:\cite{AruMasGor:02}]

\section{Kalman Filter}

\section{Particle Filter}

\section{Marginalized Particle Filter}


\chapter{Software analysis}

\section{Requirements}

Ideal library for Bayesian filtering would posses following properties...:

\section{Programming paradigms}

Interpreted vs. Compiled

Object-oriented, procedural and Functional

pass-by reference vs. copy-on-write (Matlab)

\section{Survey of Existing Libraries for Bayesian estimation/decision making}

Brief survey of existing libraries ... not fullfilling all requirements..

The need to implement a new one :-)

\section{C++}

BDM

 - advantages of C (speed, C prevalence (many optimised libraries, BLAS, LAPACK.., OpenMP)

 - disadvantages of C in our ``situation'' (steep learning curve, coplexity because of low-levelness
   high initial barriers (need to have compiler, libraries...), inconveniently long edit/build/test
   process)

\section{Matlab}

BDM (partially?)

 - advantages (popularity, existing toolboxes, rapid development (high-level)

 - disadv: strict copy-on-write, problematic object model (not in original design), difficulties
           interfacing existing C (F) code

\section{Python}

NumPy.... parallelisation (approaches, improvements in Py 3.2) - GIL.. Py3k

\section{Cython}

general info etc... extension types, building, ease of interfacing C (and F) code, .pxd files,
NumPy support

[citations:\cite{BehBraSel:09,Sel:09,BehBraCitDalSelSmi:11}]

\subsection{Gradual Optimisation and Parallelisation}

how can optimisaion be approached (gradually) and why this approach is superior

integrate\_python\_cython example (``100x'' speedup for a special (very simple) case)

\subsection{Parallelisation}

integrate\_python\_cython patched with OpenMP (13x speedup in 16-core system)

prange CEP

\subsection{Pure Python mode}

About it and why it should be used in a hypothetical bayesian python library

\subsection{Limitations}

2 types:

	not-supported code (few cases, but bad, ongoing work)

	not-optimised code (much more work needed, but not hard to fix in most cases)

		- exception handling (functions returning void etc)

		- limitations of pure python mode in regards to traditional .pyx files

\section{Choice}

python/cython was choosen ...


\chapter{The PyBayes Library}

Introduction, general directions, future considerations

+ open development on github, open-source

\section{Interpreted and Compiled}

\section{Library Layout}

[proposed citation: \cite{Smi:05}]

\subsection{Random Variable Meta-representation}

Why it is needed (ref to ProdCPdf)

\subsection{Probability Density Functions}

Nice UML diagrams! (better more smaller UMLs than one big) One for general pdf layut, one for
AbstractGaussPdf family, one for AbstractEmpPdf family

\subsection{Bayesian Filters}

UML

Nice graph of a run of a particle filter (Mirda has the plotting code)

similar of marginalized particle filter? (gausses would be plotted vertically)

[mention this:\cite{Smi:10}]

\section{Documentation, Testing and Profiling}

TODO: move above Library Layout?

Documenting using Sphinx, approach to documentation (mathematician-oriented), math in documentation

Testing - the separation of

- tests: test one class in isolation, quick, determinism (would be good, not achievable)

- stresses: test a great portion of code at once, run longer, non-determinism..

Profiling python/cython - how, existing support in PyBayes

- how to correct profiling-induced overhead

\section{Comparison with BDM}


\chapter*{Conclusion} \addcontentsline{toc}{chapter}{Conclusion}


% použitá literatura
\clearpage % so that the contents link mentions correct page
\phantomsection % so that hyperref makes correct reference
\addcontentsline{toc}{chapter}{\bibname}
\bibliographystyle{plain}
\bibliography{bibliography}

\ifrelease
	% přílohy
	\appendix % aby LaTeX cisloval jinak
	\clearpage % so that the contents link mentions correct page
	\phantomsection % so that hyperref makes correct reference
	\addcontentsline{toc}{chapter}{\appendixname}

	\part*{\appendixname}

	\includepdf[pages=-]{../doc/_build/latex/PyBayes.pdf}
\fi

\end{document}
